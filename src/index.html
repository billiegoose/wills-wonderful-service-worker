<!DOCTYPE html>
<title>WWSW.js</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/picnic@6.4.0/picnic.min.css">
<h1>WWSW.js Test Page</h1>
<button id="registerWWSW">Register WWSW</button>
<button id="connectWithComlink">Connect with Comlink</button>
<button id="doThings">Do Things</button>

<script type="module">
  import { setupServiceWorker, waitForWorker, fs, fsEvents, git } from './client.js'
  function log (str) {
    var div = document.createElement('h4')
    div.innerHTML = str
    document.body.appendChild(div)
  }

  export async function registerWWSW () {
    await setupServiceWorker('./worker.umd.js')
  }

  export async function connectWithComlink () {
    await waitForWorker()
    fsEvents.on('write', function (args) {
      console.log('Received: ', args)
    })
    fsEvents.on('mkdir', function (args) {
      console.log('Received: ', args)
    })
  }

  export async function doThings () {
    console.log(await fs.readFile('.uuid', 'utf8'))
    console.log(await fs.readdir('.'))
    console.log(await git.init({dir: '.'}))
    fsEvents.emit('foobar', {type: 'barbarbar'})
  }

  document.getElementById('registerWWSW').addEventListener('click', registerWWSW)
  document.getElementById('connectWithComlink').addEventListener('click', connectWithComlink)
  document.getElementById('doThings').addEventListener('click', doThings)
</script>